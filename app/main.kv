#:kivy 2.0.0
#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import BackgroundColorBehavior kivymd.uix.behaviors.backgroundcolor_behavior


<Check@MDCheckbox>:
    group: 'group'
    size_hint: None, None
    size: dp(48), dp(48)

<GameBall@FloatLayout>:
    size_hint: None, None
    size: dp(48), dp(48)

    Image:
        source: 'resources/img/black.png'

<RootScreen>
    transition: SlideTransition()
    StartScreen:
    GameScreen:
    SettingsScreen:
    HelpScreen:

<StartScreen>
    name: "start"
    FitImage:
        source: 'resources/img/bg.png'
    # background: 'resources/img/bg.png'
    # md_bg_color: 0, 1, 0, 1
    # canvas.before:
    #     Rectangle:
    #         pos:self.pos
    #         size:self.size
    #         source: 'resources/img/bg.png'

    MDBoxLayout:
        orientation:'vertical'

        AnchorLayout:
            size_hint: 1, 0.4
            anchor_x: 'center'
            anchor_y: 'top'
            padding: 25, 50, 25, 25

            MDBoxLayout:
                orientation: 'vertical'

                MDLabel:
                    text: "Magic Line"
                    halign: "center"
                    font_style: 'H3'

        AnchorLayout:
            size_hint: 1, 0.6
            anchor_x: 'center'
            anchor_y: 'bottom'
            padding: 25, 25, 25, 50

            MDBoxLayout:
                orientation: 'vertical'
                spacing: 1

                MDFillRoundFlatButton:
                    text: "Start"
                    md_bg_color: 0, 0, 0, 1
                    on_press:
                        root.manager.transition.direction = 'left'
                        root.manager.transition.duration = 0.1
                        root.manager.current = "game"
                        # app.start_game()
                    size: self.width, 50
                    size_hint: .75, None
                    pos_hint: {'center_x':.5, 'center_y':.5}

                MDFillRoundFlatButton:
                    text: "Settings"
                    md_bg_color: 0, 0, 0, 1
                    on_press:
                        root.manager.transition.direction = 'left'
                        root.manager.transition.duration = 0.1
                        root.manager.current = "settings"
                    size: self.width, 50
                    size_hint: .75, None
                    pos_hint: {'center_x':.5, 'center_y':.5}

                MDFillRoundFlatButton:
                    text: "Help"
                    md_bg_color: 0, 0, 0, 1
                    on_press:
                        root.manager.transition.direction = 'left'
                        root.manager.transition.duration = 0.1
                        root.manager.current = "help"
                    size: self.width, 50
                    size_hint: .75, None
                    pos_hint: {'center_x':.5, 'center_y':.5}

                MDFillRoundFlatButton:
                    text: "Exit"
                    md_bg_color: 0, 0, 0, 1
                    on_press:
                        app.show_exit_dialog()
                    size: self.width, 50
                    size_hint: .75, None
                    pos_hint: {'center_x':.5, 'center_y':.5}            

<GameScreen>
    name:"game"
    game_grid: game_grid
    game_time: game_time
    game_score: game_score
    FitImage:
        source: 'resources/img/bg.png'
    
    MDBoxLayout:
        orientation: 'vertical'

        AnchorLayout:
            size_hint: 1, 0.1
            anchor_x: 'center'
            anchor_y: 'top'

            MDToolbar:
                title: "Magic Line"
                left_action_items: [["arrow-left", lambda x: root.set_screen()]]
        
        AnchorLayout:
            size_hint: 1, 0.1
            anchor_x: 'center'
            anchor_y:'top'

            MDBoxLayout:
                orientation: 'horizontal'

                MDBoxLayout:
                    orientation: 'vertical'
                    md_bg_color: 1, 1, 1, 1

                    MDLabel:
                        text: "Time"
                        halign: 'center'

                    MDLabel:
                        id: game_time
                        halign: 'center'
                        text: "00:00:00"

                MDBoxLayout:
                    orientation: 'vertical'
                    md_bg_color: 1, 1, 1, 1

                    MDLabel:
                        text: "Score"
                        halign: 'center'

                    MDLabel:
                        id: game_score
                        halign: 'center'
                        text: "0"

        FloatLayout:
            size: 25, 25
            size_hint: 1, .5
            pos_hint: {'center_x':0.5, 'center_y':0.5}
            # Image:
            #     source: 'resources/img/Board2.png'
            # canvas.before:
            #     BorderImage:
            #         source: 'resources/img/Board2.png'
            #         pos: self.pos
            #         size: self.size
            #         auto_scale: 'y_only'
                    # effects: ew.FXAAEffect()
            
            MDBoxLayout:
                id: game_grid
                orientation: "vertical"
                # cols: 10
                # rows: 10
                line_color: 0, 0, 0, 1
                pos_hint: {'center_x':0.5}

            

<SettingsScreen>
    name:"settings"
    bgm_off: bgm_off
    bgm_on: bgm_on
    FitImage:
        source: 'resources/img/bg.png'
    
    MDBoxLayout:
        orientation: "vertical"

        AnchorLayout:
            size_hint: 1, 0.25
            anchor_x: 'center'
            anchor_y: 'top'

            MDToolbar:
                title: "Settings"
                left_action_items: [["arrow-left", lambda x: root.set_screen()]]

        AnchorLayout:
            size_hint: 1, 0.75
            anchor_x: 'center'
            anchor_y: 'center'
            padding: 25, 0, 25, 75

            MDBoxLayout:
                md_bg_color: 1, 1, 1, 1
                orientation: 'vertical'
                padding: 25, 0, 25, 0

                MDBoxLayout:
                    orientation: 'horizontal'

                    MDBoxLayout:
                        orientation: 'vertical'

                        MDLabel:
                            text: "BGM"

                        MDLabel:
                            text: "SFX"

                        MDLabel:
                            text:"Diffculty"
                    
                    MDBoxLayout:
                        orientation: 'vertical'

                        MDBoxLayout:
                            orientation: 'horizontal'
                            padding: 0, 0, 0, 50

                            SoundToggle:
                                id: bgm_on
                                text: "On"
                                group: "bgm"
                                state: "down"

                            SoundToggle:
                                id: bgm_off
                                text: "Off"
                                group: "bgm"
                                state: "normal"

                        MDSlider:
                            id: "sfx_slider"
                            min: 0
                            max: 100
                            value: 50
                            on_value: root.on_sfx_slider_value(self)

                        MDBoxLayout:
                            id: "game_difficulty"
                            orientation: 'horizontal'
                            padding: 0, 0, 0, 25

                            MDBoxLayout:
                                orientation: 'vertical'
                                padding: 0, 25, 0, 0
                                spacing: 5
                        
                                Check:
                                    id: easy
                                    size_hint: 1, 0.2
                                    size: "24dp", "28dp"
                                    # pos_hint: {'center_y':.5, 'center_x':.5}
                                    on_active: root.on_checkbox_active(*args)
                                    active: True

                                Check:
                                    id: medium
                                    size_hint: 1, 0.2
                                    size: "24dp", "28dp"
                                    on_active: root.on_checkbox_active(*args)
                                    # pos_hint: {'center_y':.5, 'center_x':.5}

                                Check:
                                    id: hard
                                    size_hint: 1, 0.2
                                    size: "24dp", "28dp"
                                    on_active: root.on_checkbox_active(*args)
                                    # pos_hint: {'center_y':.5, 'center_x':.5}
                            
                            MDBoxLayout:
                                orientation: 'vertical'
                                padding: 0, 50, 0, 10
                                spacing: 28

                                MDLabel:
                                    text: "Easy"

                                MDLabel:
                                    text: "Medium"

                                MDLabel:
                                    text:"Hard"

<HelpScreen>
    name:"help"
    FitImage:
        source: 'resources/img/bg.png'
    
    MDBoxLayout:
        orientation: "vertical"

        AnchorLayout:
            size_hint: 1, 0.25
            anchor_x: 'center'
            anchor_y: 'top'

            MDToolbar:
                title: "Help"
                left_action_items: [["arrow-left", lambda x: root.set_screen()]]

        AnchorLayout:
            size_hint: 1, 0.75
            anchor_x: 'center'
            anchor_y: 'top'
            padding: 25, 0, 25, 75

            MDBoxLayout:
                md_bg_color: 1, 1, 1, 1
                orientation: 'vertical'
                padding: 25, 0, 25, 0

                MDLabel:
                    size_hint: 1, 0.38
                    text: "How to Play"
                    halign: "center"
                    font_style: 'H6'

                MDLabel:
                    text: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."
                    halign: "justify"
                    font_style: 'Body1'